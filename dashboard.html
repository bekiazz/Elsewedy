<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Dashboard</h2>
  <button onclick="window.location.href='add-offer.html'">Add Offer</button>
  <button id="logoutBtn">Logout</button>

  <h3>Offers List</h3>
  <ul id="offersList"></ul>

  <script type="module">
    import { auth, db } from "./firebase.js";
    import { signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import { collection, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const offersList = document.getElementById("offersList");
    const logoutBtn = document.getElementById("logoutBtn");

    // Protect page: redirect if not logged in
    onAuthStateChanged(auth, (user) => {
      if (!user) window.location.href = "login.html";
    });

    logoutBtn.addEventListener("click", () => {
      signOut(auth).then(() => window.location.href = "login.html");
    });

    async function loadOffers() {
      const querySnapshot = await getDocs(collection(db, "offers"));
      offersList.innerHTML = "";
      querySnapshot.forEach((docItem) => {
        const data = docItem.data();
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${data.title}</strong> - ${data.description}
          <button class="editBtn">Edit</button>
          <button class="deleteBtn">Delete</button>
        `;

        // Delete functionality
        li.querySelector(".deleteBtn").addEventListener("click", async () => {
          if (confirm("Are you sure you want to delete this offer?")) {
            await deleteDoc(doc(db, "offers", docItem.id));
            loadOffers(); // reload after deletion
          }
        });

        // Edit functionality
        li.querySelector(".editBtn").addEventListener("click", async () => {
          const newTitle = prompt("Enter new title", data.title);
          const newDescription = prompt("Enter new description", data.description);

          if (newTitle && newDescription) {
            await updateDoc(doc(db, "offers", docItem.id), {
              title: newTitle,
              description: newDescription
            });
            loadOffers(); // reload after update
          }
        });

        offersList.appendChild(li);
      });
    }

    loadOffers();
  </script>
</body>
</html>

